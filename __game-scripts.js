var CannonWorld=pc.createScript("cannonWorld");CannonWorld.attributes.add("fixedTimeStep",{type:"number",default:.016666,title:"Fixed Time Step"}),CannonWorld.attributes.add("iterations",{type:"number",default:3,title:"Iterations"}),CannonWorld.attributes.add("gravity",{type:"vec3",default:[0,-9.8,0],title:"Gravity"}),CannonWorld.attributes.add("debugMode",{type:"boolean",title:"Debug Mode"}),CannonWorld.BODYTYPE_STATIC=0,CannonWorld.BODYTYPE_DYNAMIC=1,CannonWorld.BODYTYPE_KINEMATIC=2,CannonWorld.BODYTYPE_TRIGGER=3,CannonWorld.EVENT_COLLISION_START="collisionstart",CannonWorld.EVENT_COLLISION_END="collisionend",CannonWorld.EVENT_TRIGGER_ENTER="triggerenter",CannonWorld.EVENT_TRIGGER_LEAVE="triggerleave",CannonWorld.prototype.initialize=function(){this.app.cannonWorld?console.warn("An Cannon world has already been created. Not creating a new one."):(this.world=new CANNON.World,this.world.gravity.set(this.gravity.x,this.gravity.y,this.gravity.z),this.world.addEventListener("beginContact",this._onBeginContact.bind(this)),this.world.addEventListener("endContact",this._onEndContact.bind(this)),this.app.cannonWorld=this,this._rigidbodies=[],this.app.systems.on("animationUpdate",this._update,this),this.on("destroy",(function(){this.app.systems.off("animationUpdate",this._update,this),this._rigidbodies=[],this.world=null,this.app.cannonWorld=null}),this))},CannonWorld.prototype._update=function(){var n=new pc.Quat;return function(t){var o,e,i;for(this.world.step(this.fixedTimeStep,t,this.iterations),o=0;o<this._rigidbodies.length;++o){var a=this._rigidbodies[o];a.body.sleepState!==CANNON.Body.SLEEPING&&(a.body.type===CANNON.Body.STATIC?(e=a.entity.getPosition(),i=a.entity.getRotation(),a.body.position.set(e.x,e.y,e.z),a.body.quaternion.set(i.x,i.y,i.z,i.w)):(e=a.body.position,i=a.body.quaternion,a.entity.setPosition(e.x,e.y,e.z),n.set(i.x,i.y,i.z,i.w||1),a.entity.setRotation(n)))}}}(),CannonWorld.prototype._onBeginContact=function(){var n={other:null};return function(t){var o=t.bodyA,e=t.bodyB,i=o&&o.sensor||e&&e.sensor?CannonWorld.EVENT_TRIGGER_ENTER:CannonWorld.EVENT_COLLISION_START;n.other=e.entity,o.entity.fire(i,n),n.other=o.entity,e.entity.fire(i,n)}}(),CannonWorld.prototype._onEndContact=function(){var n={other:null};return function(t){var o=t.bodyA,e=t.bodyB,i=o&&o.sensor||e&&e.sensor?CannonWorld.EVENT_TRIGGER_LEAVE:CannonWorld.EVENT_COLLISION_END;n.other=e&&e.entity,o&&o.entity.fire(i,n),n.other=o&&o.entity,e&&e.entity.fire(i,n)}}(),CannonWorld.prototype._addRigidbody=function(n){this.world.addBody(n.cannonBody),this._rigidbodies.push({body:n.cannonBody,entity:n})},CannonWorld.prototype._removeRigidbody=function(n){var t;for(t=0;t<this._rigidbodies.length;++t){var o=this._rigidbodies[t];if(n.cannonBody===o.body){this._rigidbodies.splice(t,1);break}}this.world.removeBody(n.cannonBody)},CannonWorld.prototype._addShape=function(n,t,o,e){var i=n.entity.getPosition(),a=n.entity.getRotation();e!==CannonWorld.BODYTYPE_STATIC&&e!==CannonWorld.BODYTYPE_TRIGGER||(o=0),n.body=new CANNON.Body({mass:o,position:new CANNON.Vec3(i.x,i.y,i.z),quaternion:new CANNON.Quaternion(a.x,a.y,a.z,a.w),shape:t,sensor:e===CannonWorld.BODYTYPE_TRIGGER}),e===CannonWorld.BODYTYPE_KINEMATIC&&(n.body.type=CANNON.Body.KINEMATIC),n.entity.cannonBody=n.body,n.body.entity=n.entity,this._addRigidbody(n.entity),n.on("destroy",(function(){this.app.cannonWorld._removeRigidbody(this.entity),this.entity.cannonBody=null,this.body=null}),n),n.on("state",(function(n){n?this.app.cannonWorld._addRigidbody(this.entity):this.app.cannonWorld._removeRigidbody(this.entity)}),n)},CannonWorld.prototype.teleport=function(n,t,o){n.cannonBody.position.set(t.x,t.y,t.z),o&&n.cannonBody.quaternion.set(o.x,o.y,o.z,o.w),n.cannonBody.velocity.set(0,0,0),n.cannonBody.angularVelocity.set(0,0,0)},CannonWorld.prototype.raycastFirst=function(){if(window.CANNON)var n=new CANNON.RaycastResult,t={entity:null,normal:new pc.Vec3,point:new pc.Vec3},o=new CANNON.Vec3,e=new CANNON.Vec3,i={};return function(a,r){return o.set(a.x,a.y,a.z),e.set(r.x,r.y,r.z),this.world.raycastClosest(o,e,i,n),n.hasHit?(t.entity=n.body.entity,t.normal.set(n.hitNormalWorld.x,n.hitNormalWorld.y,n.hitNormalWorld.x),t.point.set(n.hitPointWorld.x,n.hitPointWorld.y,n.hitPointWorld.z),t):null}}(),CannonWorld.prototype.raycastAll=function(){if(window.CANNON)var n=[],t=new CANNON.Vec3,o=new CANNON.Vec3,e={};var cannonCallback=function(t){var o={};o.entity=t.body.entity,o.normal=new pc.Vec3(t.hitNormalWorld.x,t.hitNormalWorld.y,t.hitNormalWorld.x),o.point=new pc.Vec3(t.hitPointWorld.x,t.hitPointWorld.y,t.hitPointWorld.z),n.push(o)};return function(i,a){return n.length=0,t.set(i.x,i.y,i.z),o.set(a.x,a.y,a.z),this.world.raycastAll(t,o,e,cannonCallback),n}}();var CannonHelper={addCannonBodyDefaults:function(n){n.attributes.add("mass",{type:"number",default:1,title:"Mass"}),n.attributes.add("type",{type:"number",default:CannonWorld.BODYTYPE_DYNAMIC,title:"Type",enum:[{Static:CannonWorld.BODYTYPE_STATIC},{Dynamic:CannonWorld.BODYTYPE_DYNAMIC},{Kinematic:CannonWorld.BODYTYPE_KINEMATIC},{Trigger:CannonWorld.BODYTYPE_TRIGGER}]})}},CannonBox=pc.createScript("cannonBox");CannonHelper.addCannonBodyDefaults(CannonBox),CannonBox.attributes.add("halfExtents",{type:"vec3",default:[.5,.5,.5],title:"Half Extents"}),CannonBox.prototype.postInitialize=function(){if(this.app.cannonWorld){var n=new CANNON.Box(new CANNON.Vec3(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z));this.app.cannonWorld._addShape(this,n,this.mass,this.type)}};var CannonSphere=pc.createScript("cannonSphere");CannonHelper.addCannonBodyDefaults(CannonSphere),CannonSphere.attributes.add("radius",{type:"number",default:.5,title:"Radius"}),CannonSphere.prototype.postInitialize=function(){if(this.app.cannonWorld){var n=new CANNON.Sphere(this.radius);this.app.cannonWorld._addShape(this,n,this.mass,this.type)}};var CannonCylinder=pc.createScript("cannonCylinder");CannonHelper.addCannonBodyDefaults(CannonCylinder),CannonCylinder.attributes.add("radius",{type:"number",default:.5,title:"Radius"}),CannonCylinder.attributes.add("height",{type:"number",default:1,title:"Height"}),CannonCylinder.attributes.add("segmentCount",{type:"number",default:8,title:"Segment Count"}),CannonCylinder.prototype.postInitialize=function(){if(this.app.cannonWorld){var n=new CANNON.Cylinder(this.radius,this.radius,this.height,this.segmentCount);this.app.cannonWorld._addShape(this,n,this.mass,this.type)}};var BoxPlacement=pc.createScript("boxPlacement");BoxPlacement.attributes.add("entities",{type:"entity",array:!0,description:"The entities to be spawned after a period of time."}),BoxPlacement.attributes.add("cameraEntity",{type:"entity",description:"The main camera entity in the scene."});var positionsX=[-.147866440563,3.3841025519,.658852585512,-2.02007463812,2.82501379275,-1.1747493252,-.615853213023,-1.50496931163,-2.30340274389,-3.15703279016,-1.89166082004,4.83798267355,-.610455711491,-1.68060717723,2.05314904686,4.19215571517,-1.4536451346,-1.28983652541,1.65729964048,-1.51029529276,4.12418865413,2.82056640452,-3.47490199453,4.53263633954,3.94223538636,1.66910890793,4.49002651348,-.590005726016,-1.30129625865,-4.94935497,-.790670118408,-2.26041408389,-4.85081915548,2.80572082355,-4.32153807404,-3.31528158806,.917681430149,1.1387831021,3.25469649949,-2.24865799047,.382786195002,-1.03833598658,-1.50953220931,3.41772674355,-3.13925958807,-.0160249037338,3.71599160786,3.41909241906,3.92548686203,1.83569949896,-4.42404705431,3.40144767558,-3.89755106699,-3.8553863801,3.89878658054,2.88947061949,4.49570100552,-3.77462228539,4.77147507537,-4.04698295717,-4.75442293667,.997654434738,-.232440478762,1.41230163721,-2.14804939265,-2.53850973629,.85630146394,2.42743450775,-1.99271439878,-2.56473220636,3.48702364432,-3.9491707569,-.155815425701,-.790112951511,-.506578729924,-.937274670446,-.921068654535,-.0561361117312,2.66622315065,3.45119862321,-2.80196681694,2.82511240896,-2.58714289409,2.52980359257,2.63231302156,-4.06667050788,3.8753260241,-3.34225504071,-2.90399074233,.408087680397,-.121918298047,1.86930015183,2.73207801657,.751632432648,3.22225075358,-4.76462933675,1.68927072777,.763925555707,-2.66783353881,-2.08476615929],positionsZ=[-1.30541597215,-.3206410513,-2.7159093156,-4.10682407024,2.58978959827,-1.59414412778,2.78036849725,2.24015927244,.726013813233,.0335012081471,4.22100364827,-2.05101088572,-.621415661326,.189790674393,-2.93102990623,-2.35429808323,3.11873724158,.764287835155,-4.02609386195,.0609465791293,-4.46899414651,2.95316208582,.0667430653072,-2.22955228983,2.95332011358,-.112304662129,-1.18939419386,-1.65296918482,-4.81127018005,2.19728492955,3.84077989938,4.54991046929,-1.91596469846,3.97909941168,4.82721569637,-.101275325935,-4.8799371661,-2.44270118988,3.12687113102,-.24356874372,3.80369729436,-2.57394765341,-1.55317273904,-3.64709749969,-3.55944718788,4.4287792683,-.136934357073,-.708503028801,1.29106088934,-2.09286021034,1.98644400317,.565480338096,-3.93313219359,2.04576244066,-2.85337254235,-3.02185743256,1.05457130933,4.85196132561,-2.4290429182,-3.71535769352,-4.90692755179,-3.59336437092,3.70914531382,3.34047088816,-3.24688219998,-.840775166087,-3.92612226491,-2.41108700054,2.55439653258,-.0376529786316,-4.88690827381,3.87831548226,-2.37646083517,1.55519453728,-1.0194152084,-3.22247395682,-.898601897574,-1.93469425744,2.69458746956,1.86907930067,-1.09652675094,-4.10817913829,-1.57597665219,2.06098697778,3.32960459357,.248620975499,-4.16954730762,3.49221881772,1.54917092554,4.72954513793,2.11099283561,.947330663305,-.739184915604,-4.51211449005,1.88026372119,-4.98687941132,2.82037985926,4.04535728004,.103063919896,1.18181495156];BoxPlacement.prototype.initialize=function(){this.app.mouse.disableContextMenu(),this.app.touch&&this.app.touch.on("touchstart",this.onTouchStart,this),this.app.mouse&&this.app.mouse.on("mousedown",this.onMouseDown,this),this.defaultPosition=new pc.Vec3(0,12,0),this.rbCounter=0;var t=this;setInterval((function(){t.defaultPosition.x=positionsX[t.rbCounter%positionsX.length],t.defaultPosition.z=positionsZ[t.rbCounter%positionsZ.length],t.spawnBox(t.defaultPosition)}),500)},BoxPlacement.prototype.onMouseDown=function(t){this.fireRaycast(t,t.button===pc.MOUSEBUTTON_RIGHT)},BoxPlacement.prototype.onTouchStart=function(t){for(var e=t.changedTouches,o=0;o<e.length;o++)this.fireRaycast(e[o],!1);t.event.preventDefault()},BoxPlacement.prototype.fireRaycast=function(t,e){var o=this.cameraEntity.getPosition(),n=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraEntity.camera.farClip);if(e)for(var a=this.app.cannonWorld.raycastAll(o,n),i=0;i<a.length;++i){var s=a[i];s&&!s.entity.tags.has("dont-destroy")&&s.entity.destroy()}else{var r=this.app.cannonWorld.raycastFirst(o,n);r&&!r.entity.tags.has("dont-destroy")&&r.entity.destroy()}},BoxPlacement._tempRandomQuat=new pc.Quat,BoxPlacement.prototype.spawnBox=function(t){var e=this.entities[Math.floor(pc.math.random(0,this.entities.length))],o=BoxPlacement._tempRandomQuat,n=e.clone();this.entity.addChild(n),n.enabled=!0,o.setFromEulerAngles(pc.math.random(0,360),pc.math.random(0,360),pc.math.random(0,360)),this.app.cannonWorld.teleport(n,t,o),this.rbCounter+=1};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactor",{type:"number",default:0,title:"Inertia Factor",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition()},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia()},OrbitCamera.prototype.initialize=function(){var t=this,onWindowResize=function(){t._checkAspectRatio()};window.addEventListener("resize",onWindowResize,!1),this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center);var i=this.entity.getRotation();if(this._yaw=this._calcYaw(i),this._pitch=this._clampPitchAngle(this._calcPitch(i,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var e=new pc.Vec3;e.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(e.length())}this._targetDistance=this._distance,this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)})),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)})),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)})),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)})),this.on("destroy",(function(){window.removeEventListener("resize",onWindowResize,!1)}))},OrbitCamera.prototype.update=function(t){var i=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,i),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,i),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,i),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e=0;if(t.model){var a=t.model.meshInstances;if(a)for(e=0;e<a.length;e++)0===i?this._modelsAabb.copy(a[e].aabb):this._modelsAabb.add(a[e].aabb),i+=1}for(e=0;e<t.children.length;++e)i+=this._buildAabb(t.children[e],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!0}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var Rotate=pc.createScript("rotate");Rotate.attributes.add("speed",{type:"number"}),Rotate.prototype.update=function(t){this.entity.rotate(0,this.speed*t,0)};var LoopingKinematic=pc.createScript("loopingKinematic");LoopingKinematic.prototype.postInitialize=function(){this.entity.cannonBody.velocity.set(0,0,20),this._startPos=this.entity.getPosition().clone()},LoopingKinematic.prototype.update=function(t){this.entity.getPosition().z>20&&(this.app.cannonWorld.teleport(this.entity,this._startPos),this.entity.cannonBody.velocity.set(0,0,20))};var ChangeColourOnCollision=pc.createScript("changeColourOnCollision");!function(){var t=new pc.Color;window.hsvToRgb=function(e,n,o){var i,a,r,s,l,h,c,d;switch(1===arguments.length&&(n=e.s,o=e.v,e=e.h),h=o*(1-n),c=o*(1-(l=6*e-(s=Math.floor(6*e)))*n),d=o*(1-(1-l)*n),s%6){case 0:i=o,a=d,r=h;break;case 1:i=c,a=o,r=h;break;case 2:i=h,a=o,r=d;break;case 3:i=h,a=c,r=o;break;case 4:i=d,a=h,r=o;break;case 5:i=o,a=h,r=c}return t.set(i,a,r)}}(),ChangeColourOnCollision.prototype.initialize=function(){this.entity.on(CannonWorld.EVENT_COLLISION_START,(function(t){this.entity.model.material.diffuse=hsvToRgb(pc.math.random(0,1),1,1),this.entity.model.material.update()}),this),this.entity.on(CannonWorld.EVENT_COLLISION_END,(function(t){this.entity.model.material.diffuse=hsvToRgb(pc.math.random(0,1),1,1),this.entity.model.material.update()}),this)};var ResetTriggerEnter=pc.createScript("resetTriggerEnter");ResetTriggerEnter.prototype.initialize=function(){this.entity.on(CannonWorld.EVENT_TRIGGER_ENTER,(function(e){this.app.cannonWorld.teleport(e.other,new pc.Vec3(0,20,0))}),this)};var CarMechanics=pc.createScript("carMechanics");CarMechanics.attributes.add("speed",{type:"number",default:30,title:"Car Speed"}),CarMechanics.prototype.initialize=function(){this.counterText=this.app.root.findByName("Counter"),this.states={scriptContext:this,currentState:null,change:function(t){this.currentState&&this.scriptContext.states.currentState.end(this.scriptContext),this.scriptContext.states.currentState=t,this.scriptContext.states.currentState.init(this.scriptContext)},startState:{totalTime:0,init:function(t){console.log("this is the init of the start state")},update:function(t,e){this.totalTime+=e,console.log("total time is: "+Math.round(this.totalTime)),t.counterText.element._text._updateText(Math.round(3-this.totalTime).toString()),this.totalTime>3&&(t.states.change(t.states.drivingState),t.app.fire("hide-counter"),t.counterText.enabled=!1)},end:function(t){console.log("this is the end of the start state")}},drivingState:{init:function(t){console.log("this is the init of the driving state")},update:function(t,e){t.app.keyboard.isPressed(pc.KEY_LEFT)?t.entity.cannonBody.angularVelocity.set(0,2,0):t.app.keyboard.isPressed(pc.KEY_RIGHT)?t.entity.cannonBody.angularVelocity.set(0,-2,0):t.entity.cannonBody.angularVelocity.set(0,0,0),t.entity.cannonBody.velocity.set(t.entity.forward.x*t.speed,0,t.entity.forward.z*t.speed)},end:function(t){console.log("this is the end of the driving state")}},crashState:{init:function(t){console.log("this is the init of the crash state"),console.log("you have crashed"),t.entity.cannonBody.velocity.set(0,0,0),t.entity.cannonBody.angularVelocity.set(0,0,0),t.app.fire("crash",!0),t.playCrashAnimation()},update:function(t,e){},end:function(t){console.log("this is the end of the crash state")}}},this.states.change(this.states.startState),this.entity.on(CannonWorld.EVENT_COLLISION_START,(function(t){console.log("I hit a wall"),this.states.change(this.states.crashState)}),this)},CarMechanics.prototype.update=function(t){this.states.currentState.update(this,t)},CarMechanics.prototype.turn=function(t){this.states.currentState==this.states.drivingState&&this.entity.cannonBody.angularVelocity.set(0,t,0)},CarMechanics.prototype.playCrashAnimation=function(){var t=this;this.tween=this.entity.tween(this.entity.getLocalEulerAngles()).rotate(new pc.Vec3(-20,this.entity.getLocalEulerAngles().y,this.entity.getLocalEulerAngles().z),.3,pc.SineOut).loop(!1).yoyo(!1).on("complete",(function(){t.tween2=this.entity.tween(this.entity.getLocalEulerAngles()).rotate(new pc.Vec3(0,this.entity.getLocalEulerAngles().y,this.entity.getLocalEulerAngles().z),.7,pc.BounceOut).loop(!1).yoyo(!1),t.tween2.start()})),this.tween.start()};var WallTriggerLogic=pc.createScript("wallTriggerLogic");WallTriggerLogic.prototype.initialize=function(){},WallTriggerLogic.prototype.update=function(i){};var CameraFollower=pc.createScript("cameraFollower");CameraFollower.attributes.add("follow",{type:"entity"}),CameraFollower.attributes.add("offset",{type:"vec3",default:[0,0,0]}),CameraFollower.attributes.add("lookAt",{type:"entity"}),CameraFollower.attributes.add("lookAtOffset",{type:"vec3",default:[0,0,0]}),CameraFollower.prototype.initialize=function(){},CameraFollower.prototype.update=function(t){},CameraFollower.prototype.postUpdate=function(t){var o=this.follow.getPosition().add(this.offset);this.entity.setPosition(o),this.entity.lookAt(this.lookAt.getPosition().add(this.lookAtOffset))};var ControlButton=pc.createScript("controlButton");ControlButton.attributes.add("turnSpeed",{type:"number",default:2}),ControlButton.attributes.add("carEntity",{type:"entity"}),ControlButton.prototype.initialize=function(){this.carMechanics=this.carEntity.script.get("carMechanics"),this._isHolding=!1,this.entity.button.on("touchstart",(function(t){this._isHolding=!0}),this),this.entity.button.on("touchend",(function(t){this._isHolding=!1}),this),this.entity.button.on("pressedstart",(function(t){this._isHolding=!0}),this),this.entity.button.on("pressedend",(function(t){this._isHolding=!1}),this)},ControlButton.prototype.update=function(t){this._isHolding&&this.carMechanics.turn(this.turnSpeed)};var TweenPosition=pc.createScript("tweenPosition");TweenPosition.attributes.add("duration",{type:"number",default:1}),TweenPosition.attributes.add("easing",{type:"string",default:"Linear"}),TweenPosition.attributes.add("delay",{type:"number",default:0}),TweenPosition.attributes.add("loop",{type:"boolean",default:!0}),TweenPosition.attributes.add("yoyo",{type:"boolean",default:!1}),TweenPosition.attributes.add("repeat",{type:"number",default:2}),TweenPosition.prototype.initialize=function(){this.reset(),this.on("attr:duration",(function(t){this.tween.duration=t}),this),this.on("attr:easing",this.reset,this),this.on("attr:delay",this.reset,this),this.on("attr:loop",this.reset,this),this.on("attr:yoyo",this.reset,this),this.on("attr:repeat",this.reset,this)},TweenPosition.prototype.reset=function(){this.tween&&this.tween.stop(),this.entity.setLocalPosition(-4,0,0),this.tween=this.entity.tween(this.entity.getLocalPosition()).to(new pc.Vec3(4,0,0),this.duration,pc[this.easing]).delay(this.delay).loop(this.loop).yoyo(this.yoyo),this.loop||this.tween.repeat(this.repeat),this.tween.start()};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.EASE_LINEAR,this._sv={},this._ev={}};Tween.prototype={to:function(t,i,e,s,n,r){return t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return t instanceof pc.Quat?this._properties={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(var t in this._properties)this._sv[t]=this._properties[t],this._ev[t]=this.target[t];if(this._slerp){this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z);var i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z;this._fromQuat.setFromEulerAngles(i,e,s)}}else{for(var t in this._properties)this._sv[t]=this.target[t],this._ev[t]=this._properties[t];if(this._slerp){this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z);i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z;this._toQuat.setFromEulerAngles(i,e,s)}}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=this.time/this.duration,r=this.easing(n);for(var h in this._properties)e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r;if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtify(!0),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties)tmp=this._sv[i],this._sv[i]=this._ev[i],this._ev[i]=tmp;this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){var t=pc.Application.getApplication();t&&(t._tweenManager=new pc.TweenManager(t),t.on("update",(function(i){t._tweenManager.update(i)})),pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.on("destroy",(function(){e.stop()})),i&&i.element&&(e.element=element),e})}();var TweenMaterial=pc.createScript("tweenMaterial");TweenMaterial.attributes.add("fromDiffuse",{type:"rgb"}),TweenMaterial.attributes.add("toDiffuse",{type:"rgb"}),TweenMaterial.attributes.add("duration",{type:"number",default:1}),TweenMaterial.attributes.add("easing",{type:"string",default:"Linear"}),TweenMaterial.attributes.add("delay",{type:"number",default:0}),TweenMaterial.attributes.add("loop",{type:"boolean",default:!0}),TweenMaterial.attributes.add("yoyo",{type:"boolean",default:!1}),TweenMaterial.attributes.add("repeat",{type:"number",default:2}),TweenMaterial.prototype.initialize=function(){this.initialMaterial=this.entity.model.material.clone(),this.reset(),this.on("attr:fromDiffuse",this.reset,this),this.on("attr:toDiffuse",this.reset,this),this.on("attr:duration",(function(t){this.tween.duration=t}),this),this.on("attr:easing",this.reset,this),this.on("attr:delay",this.reset,this),this.on("attr:loop",this.reset,this),this.on("attr:yoyo",this.reset,this),this.on("attr:repeat",this.reset,this)},TweenMaterial.prototype.reset=function(){this.tween&&this.tween.stop(),this.tweenedProperties={diffuse:this.fromDiffuse.clone()},this.entity.model.material=this.initialMaterial.clone(),this.entity.model.material.diffuse=this.fromDiffuse,this.entity.model.material.update(),this.tween=this.app.tween(this.tweenedProperties.diffuse).to(this.toDiffuse,this.duration,pc[this.easing]).delay(this.delay).loop(this.loop).yoyo(this.yoyo),this.loop||this.tween.repeat(this.repeat),this.tween.on("update",function(){this.entity.model.material.diffuse=this.tweenedProperties.diffuse,this.entity.model.material.update()}.bind(this)),this.tween.start()};var TweenRotation=pc.createScript("tweenRotation");TweenRotation.attributes.add("duration",{type:"number",default:1}),TweenRotation.attributes.add("easing",{type:"string",default:"Linear"}),TweenRotation.attributes.add("delay",{type:"number",default:0}),TweenRotation.attributes.add("loop",{type:"boolean",default:!0}),TweenRotation.attributes.add("yoyo",{type:"boolean",default:!1}),TweenRotation.attributes.add("repeat",{type:"number",default:2}),TweenRotation.prototype.initialize=function(){this.reset(),this.on("attr:duration",(function(t){this.tween.duration=t}),this),this.on("attr:easing",this.reset,this),this.on("attr:delay",this.reset,this),this.on("attr:loop",this.reset,this),this.on("attr:yoyo",this.reset,this),this.on("attr:repeat",this.reset,this)},TweenRotation.prototype.reset=function(){this.tween&&this.tween.stop(),this.entity.setLocalEulerAngles(0,0,0),this.tween=this.entity.tween(this.entity.getLocalEulerAngles()).rotate(new pc.Vec3(180,0,90),this.duration,pc[this.easing]).delay(this.delay).loop(this.loop).yoyo(this.yoyo),this.loop||this.tween.repeat(this.repeat),this.tween.start()};var TweenScale=pc.createScript("tweenScale");TweenScale.attributes.add("duration",{type:"number",default:1}),TweenScale.attributes.add("easing",{type:"string",default:"Linear"}),TweenScale.attributes.add("delay",{type:"number",default:0}),TweenScale.attributes.add("loop",{type:"boolean",default:!0}),TweenScale.attributes.add("yoyo",{type:"boolean",default:!1}),TweenScale.attributes.add("repeat",{type:"number",default:2}),TweenScale.prototype.initialize=function(){this.reset(),this.on("attr:duration",(function(t){this.tween.duration=t}),this),this.on("attr:easing",this.reset,this),this.on("attr:delay",this.reset,this),this.on("attr:loop",this.reset,this),this.on("attr:yoyo",this.reset,this),this.on("attr:repeat",this.reset,this)},TweenScale.prototype.reset=function(){this.tween&&this.tween.stop(),this.entity.setLocalScale(1,1,1),this.tween=this.entity.tween(this.entity.getLocalScale()).to(new pc.Vec3(3,3,3),this.duration,pc[this.easing]).delay(this.delay).loop(this.loop).yoyo(this.yoyo),this.loop||this.tween.repeat(this.repeat),this.tween.start()};var Uilogic=pc.createScript("uilogic");Uilogic.attributes.add("counterText",{type:"entity"}),Uilogic.attributes.add("startText",{type:"entity"}),Uilogic.attributes.add("insuranceCallActionText",{type:"entity"}),Uilogic.prototype.initialize=function(){var t=this;this.app.on("crash",(function(){t.insuranceCallActionText.enabled=!0})),this.app.on("hide-counter",(function(){t.counterText.enabled=!1,t.startText.enabled=!0,setTimeout((function(){t.startText.enabled=!1}),1e3)}))},Uilogic.prototype.update=function(t){};